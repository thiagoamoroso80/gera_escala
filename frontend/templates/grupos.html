{% extends "base.html" %}

{% block content %}
<div class="container-fluid px-0">
    <!-- Cabeçalho Responsivo -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
        <div class="mb-3 mb-md-0">
            <h1 class="h3 mb-1">
                <i class="bi bi-collection me-2"></i>Grupos
            </h1>
            <p class="text-muted mb-0">
                Gerencie grupos de defumação e limpeza
            </p>
        </div>
        
        <div class="d-flex align-items-center">
            <span class="badge bg-info d-none d-md-inline">
                <i class="bi bi-diagram-3 me-1"></i>
                Total: {{ (grupos_lar|length if grupos_lar else 0) + (grupos_tenda|length if grupos_tenda else 0) }}
            </span>
        </div>
    </div>

    <!-- Estatísticas Rápidas -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="card border-success border-2">
                <div class="card-body text-center py-3">
                    <div class="text-success mb-1">
                        <i class="bi bi-house-door" style="font-size: 1.5rem;"></i>
                    </div>
                    <div class="fs-4 fw-bold">{{ grupos_lar|length if grupos_lar else 0 }}</div>
                    <small class="text-muted">Grupos Lar</small>
                </div>
            </div>
        </div>
        
        <div class="col-6 col-md-3">
            <div class="card border-primary border-2">
                <div class="card-body text-center py-3">
                    <div class="text-primary mb-1">
                        <i class="bi bi-stars" style="font-size: 1.5rem;"></i>
                    </div>
                    <div class="fs-4 fw-bold">{{ grupos_tenda|length if grupos_tenda else 0 }}</div>
                    <small class="text-muted">Grupos Tenda</small>
                </div>
            </div>
        </div>
        
        <div class="col-6 col-md-3">
            <div class="card border-warning border-2">
                <div class="card-body text-center py-3">
                    <div class="text-warning mb-1">
                        <i class="bi bi-people" style="font-size: 1.5rem;"></i>
                    </div>
                    <div class="fs-4 fw-bold">
                        {{ grupos_lar|sum(attribute='participantes_ids')|default(0) + grupos_tenda|sum(attribute='participantes_ids')|default(0) }}
                    </div>
                    <small class="text-muted">Participantes</small>
                </div>
            </div>
        </div>
        
        <div class="col-6 col-md-3">
            <div class="card border-info border-2">
                <div class="card-body text-center py-3">
                    <div class="text-info mb-1">
                        <i class="bi bi-gear" style="font-size: 1.5rem;"></i>
                    </div>
                    <button class="btn btn-sm btn-outline-success mb-1" data-bs-toggle="modal" data-bs-target="#modalGrupoLar">
                        <i class="bi bi-plus"></i> Lar
                    </button>
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalGrupoTenda">
                        <i class="bi bi-plus"></i> Tenda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Grupos - Layout Responsivo -->
    <div class="row g-3">
        <!-- Grupos do Lar -->
        <div class="col-12 col-lg-6">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                        <h5 class="mb-2 mb-md-0">
                            <i class="bi bi-house-door me-2"></i>
                            <span class="d-none d-md-inline">Grupos do Lar</span>
                            <span class="d-inline d-md-none">Grupos Lar</span>
                        </h5>
                        
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-light text-dark">
                                {{ grupos_lar|length if grupos_lar else 0 }}
                            </span>
                            <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#modalGrupoLar">
                                <i class="bi bi-plus"></i>
                                <span class="d-none d-sm-inline">Novo</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-0">
                    {% if grupos_lar and grupos_lar|length > 0 %}
                        <!-- Desktop: Lista organizada -->
                        <div class="d-none d-md-block">
                            <div class="list-group list-group-flush">
                                {% for grupo in grupos_lar %}
                                <div class="list-group-item border-0">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <div class="d-flex align-items-center mb-2">
                                                <h6 class="mb-0 me-2">{{ grupo.nome }}</h6>
                                                <span class="badge bg-{% if grupo.dia_defumacao == 'sabado' %}success{% else %}info{% endif %}">
                                                    {{ grupo.dia_defumacao|title }}
                                                </span>
                                            </div>
                                            <div class="d-flex flex-wrap gap-2 mb-2">
                                                <small class="text-muted">
                                                    <i class="bi bi-hash me-1"></i>ID: {{ grupo.id }}
                                                </small>
                                                <small class="text-muted">
                                                    <i class="bi bi-sort-numeric-up me-1"></i>Ordem: {{ grupo.ordem_rotacao }}
                                                </small>
                                                <small class="text-muted">
                                                    <i class="bi bi-people me-1"></i>
                                                    {{ grupo.participantes_ids.split(',')|length if grupo.participantes_ids else 0 }} participantes
                                                </small>
                                            </div>
                                        </div>
                                        <div class="btn-group btn-group-sm ms-2" role="group">
                                            <button type="button" class="btn btn-outline-success btn-editar" 
                                                    data-bs-toggle="tooltip" title="Editar"
                                                    data-grupo-id="{{ grupo.id }}"
                                                    data-grupo-tipo="lar">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-danger btn-excluir"
                                                    data-bs-toggle="tooltip" title="Excluir"
                                                    data-grupo-id="{{ grupo.id }}"
                                                    data-grupo-tipo="lar">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% if not loop.last %}
                                <hr class="my-1 mx-3">
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Mobile: Cards compactos -->
                        <div class="d-md-none">
                            <div class="row g-2 p-3">
                                {% for grupo in grupos_lar %}
                                <div class="col-12">
                                    <div class="card border-success-subtle">
                                        <div class="card-body py-2">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <div>
                                                    <h6 class="mb-0">{{ grupo.nome }}</h6>
                                                    <small class="text-muted">ID: {{ grupo.id }}</small>
                                                </div>
                                                <span class="badge bg-{% if grupo.dia_defumacao == 'sabado' %}success{% else %}info{% endif %}">
                                                    {{ grupo.dia_defumacao|title|slice(0, 3) }}
                                                </span>
                                            </div>
                                            
                                            <div class="row g-1 mb-2">
                                                <div class="col-6">
                                                    <small class="text-muted d-block">
                                                        <i class="bi bi-sort-numeric-up me-1"></i>
                                                        Ordem {{ grupo.ordem_rotacao }}
                                                    </small>
                                                </div>
                                                <div class="col-6">
                                                    <small class="text-muted d-block">
                                                        <i class="bi bi-people me-1"></i>
                                                        {{ grupo.participantes_ids.split(',')|length if grupo.participantes_ids else 0 }}
                                                    </small>
                                                </div>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-muted">
                                                    <i class="bi bi-house-door me-1"></i>
                                                    Defumação
                                                </small>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <button type="button" class="btn btn-outline-success btn-sm btn-editar"
                                                            data-grupo-id="{{ grupo.id }}"
                                                            data-grupo-tipo="lar">
                                                        <i class="bi bi-pencil"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-outline-danger btn-sm btn-excluir"
                                                            data-grupo-id="{{ grupo.id }}"
                                                            data-grupo-tipo="lar">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <div class="mb-3">
                                <i class="bi bi-collection text-muted" style="font-size: 3rem;"></i>
                            </div>
                            <h6 class="text-muted mb-2">Nenhum grupo Lar cadastrado</h6>
                            <p class="text-muted small mb-3">
                                Crie um grupo para começar a organizar as defumações
                            </p>
                            <button class="btn btn-success btn-mobile-block" data-bs-toggle="modal" data-bs-target="#modalGrupoLar">
                                <i class="bi bi-plus me-1"></i>
                                <span class="d-none d-sm-inline">Criar Primeiro Grupo</span>
                                <span class="d-inline d-sm-none">Novo Grupo</span>
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Grupos da Tenda -->
        <div class="col-12 col-lg-6">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                        <h5 class="mb-2 mb-md-0">
                            <i class="bi bi-stars me-2"></i>
                            <span class="d-none d-md-inline">Grupos da Tenda</span>
                            <span class="d-inline d-md-none">Grupos Tenda</span>
                        </h5>
                        
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-light text-dark">
                                {{ grupos_tenda|length if grupos_tenda else 0 }}
                            </span>
                            <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#modalGrupoTenda">
                                <i class="bi bi-plus"></i>
                                <span class="d-none d-sm-inline">Novo</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-0">
                    {% if grupos_tenda and grupos_tenda|length > 0 %}
                        <!-- Desktop: Lista organizada -->
                        <div class="d-none d-md-block">
                            <div class="list-group list-group-flush">
                                {% for grupo in grupos_tenda %}
                                <div class="list-group-item border-0">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <div class="d-flex align-items-center mb-2">
                                                <h6 class="mb-0 me-2">{{ grupo.nome }}</h6>
                                                {% if grupo.dia_preferencial %}
                                                <span class="badge bg-{% if grupo.dia_preferencial == 'sabado' %}success{% else %}info{% endif %}">
                                                    Prefere {{ grupo.dia_preferencial }}
                                                </span>
                                                {% endif %}
                                            </div>
                                            <div class="d-flex flex-wrap gap-2 mb-2">
                                                <small class="text-muted">
                                                    <i class="bi bi-hash me-1"></i>ID: {{ grupo.id }}
                                                </small>
                                                <small class="text-muted">
                                                    <i class="bi bi-people me-1"></i>
                                                    {{ grupo.participantes_ids.split(',')|length if grupo.participantes_ids else 0 }} participantes
                                                </small>
                                            </div>
                                        </div>
                                        <div class="btn-group btn-group-sm ms-2" role="group">
                                            <button type="button" class="btn btn-outline-primary btn-editar" 
                                                    data-bs-toggle="tooltip" title="Editar"
                                                    data-grupo-id="{{ grupo.id }}"
                                                    data-grupo-tipo="tenda">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-danger btn-excluir"
                                                    data-bs-toggle="tooltip" title="Excluir"
                                                    data-grupo-id="{{ grupo.id }}"
                                                    data-grupo-tipo="tenda">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% if not loop.last %}
                                <hr class="my-1 mx-3">
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Mobile: Cards compactos -->
                        <div class="d-md-none">
                            <div class="row g-2 p-3">
                                {% for grupo in grupos_tenda %}
                                <div class="col-12">
                                    <div class="card border-primary-subtle">
                                        <div class="card-body py-2">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <div>
                                                    <h6 class="mb-0">{{ grupo.nome }}</h6>
                                                    <small class="text-muted">ID: {{ grupo.id }}</small>
                                                </div>
                                                {% if grupo.dia_preferencial %}
                                                <span class="badge bg-{% if grupo.dia_preferencial == 'sabado' %}success{% else %}info{% endif %}">
                                                    {{ grupo.dia_preferencial|title|slice(0, 3) }}
                                                </span>
                                                {% endif %}
                                            </div>
                                            
                                            <div class="mb-2">
                                                <small class="text-muted">
                                                    <i class="bi bi-people me-1"></i>
                                                    {{ grupo.participantes_ids.split(',')|length if grupo.participantes_ids else 0 }} participantes
                                                </small>
                                            </div>
                                            
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-muted">
                                                    <i class="bi bi-stars me-1"></i>
                                                    Limpeza
                                                </small>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <button type="button" class="btn btn-outline-primary btn-sm btn-editar"
                                                            data-grupo-id="{{ grupo.id }}"
                                                            data-grupo-tipo="tenda">
                                                        <i class="bi bi-pencil"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-outline-danger btn-sm btn-excluir"
                                                            data-grupo-id="{{ grupo.id }}"
                                                            data-grupo-tipo="tenda">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <div class="mb-3">
                                <i class="bi bi-stars text-muted" style="font-size: 3rem;"></i>
                            </div>
                            <h6 class="text-muted mb-2">Nenhum grupo Tenda cadastrado</h6>
                            <p class="text-muted small mb-3">
                                Crie um grupo para organizar as limpezas mensais
                            </p>
                            <button class="btn btn-primary btn-mobile-block" data-bs-toggle="modal" data-bs-target="#modalGrupoTenda">
                                <i class="bi bi-plus me-1"></i>
                                <span class="d-none d-sm-inline">Criar Primeiro Grupo</span>
                                <span class="d-inline d-sm-none">Novo Grupo</span>
                            </button>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Dica para Mobile -->
    <div class="d-md-none mt-4">
        <div class="alert alert-light border">
            <div class="d-flex align-items-center">
                <div class="me-3">
                    <i class="bi bi-phone text-primary" style="font-size: 1.5rem;"></i>
                </div>
                <div>
                    <small class="text-muted">
                        <strong>Dica:</strong> Toque em um grupo para expandir detalhes. 
                        Use os botões + para criar novos grupos.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Grupo Lar -->
<div class="modal fade" id="modalGrupoLar" tabindex="-1" aria-labelledby="modalGrupoLarLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="bi bi-house-door me-2"></i>Novo Grupo - Lar
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="/grupos/adicionar/lar">
                <input type="hidden" name="username" value="admin">
                <input type="hidden" name="password" value="{{ request.query_params.get('password', '') }}">
                
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nome do Grupo *</label>
                        <input type="text" class="form-control" name="nome" required 
                               placeholder="Ex: Grupo 1, Grupo Alpha">
                    </div>
                    
                    <div class="row g-2">
                        <div class="col-12 col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Dia da Defumação *</label>
                                <select class="form-select" name="dia_defumacao" required>
                                    <option value="">Selecione...</option>
                                    <option value="sabado">Sábado</option>
                                    <option value="domingo">Domingo</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Ordem de Rotação</label>
                                <input type="number" class="form-control" name="ordem_rotacao" 
                                       value="1" min="1" max="10">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-text">
                        <i class="bi bi-info-circle me-1"></i>
                        A ordem define a sequência de escalas no ano.
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x me-1"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-check me-1"></i> Criar Grupo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Grupo Tenda -->
<div class="modal fade" id="modalGrupoTenda" tabindex="-1" aria-labelledby="modalGrupoTendaLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="bi bi-stars me-2"></i>Novo Grupo - Tenda
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="/grupos/adicionar/tenda">
                <input type="hidden" name="username" value="admin">
                <input type="hidden" name="password" value="{{ request.query_params.get('password', '') }}">
                
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nome do Grupo *</label>
                        <input type="text" class="form-control" name="nome" required 
                               placeholder="Ex: Grupo Limpeza, Grupo Beta">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Dia Preferencial</label>
                        <select class="form-select" name="dia_preferencial">
                            <option value="">Qualquer dia</option>
                            <option value="sabado">Sábado</option>
                            <option value="domingo">Domingo</option>
                        </select>
                        <div class="form-text">
                            Define preferência para limpezas (opcional)
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x me-1"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check me-1"></i> Criar Grupo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- CSS Adicional para Responsividade -->
<style>
    /* Botões responsivos */
    .btn-mobile-block {
        width: 100%;
    }
    
    @media (min-width: 576px) {
        .btn-mobile-block {
            width: auto;
        }
    }
    
    /* Cards de grupo */
    .card.border-success-subtle {
        border-color: rgba(40, 167, 69, 0.2) !important;
    }
    
    .card.border-primary-subtle {
        border-color: rgba(0, 123, 255, 0.2) !important;
    }
    
    /* Ajustes para mobile */
    @media (max-width: 767.98px) {
        .card-header h5 {
            font-size: 1.1rem;
        }
        
        .card.border-success-subtle,
        .card.border-primary-subtle {
            margin-bottom: 8px;
        }
        
        .card.border-success-subtle .card-body,
        .card.border-primary-subtle .card-body {
            padding: 12px;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 0.875rem;
        }
        
        /* Ajustar badges em mobile */
        .badge {
            font-size: 0.75rem;
            padding: 4px 8px;
        }
    }
    
    @media (max-width: 575.98px) {
        .card-header {
            padding: 12px 15px;
        }
        
        .card.border-success-subtle .card-body,
        .card.border-primary-subtle .card-body {
            padding: 10px;
        }
        
        .btn-sm {
            padding: 3px 6px;
            font-size: 0.8rem;
        }
        
        /* Grid de estatísticas */
        .row.g-3 .col-6 {
            padding: 6px;
        }
        
        .card.border-2 .card-body {
            padding: 15px 8px;
        }
        
        .card.border-2 .fs-4 {
            font-size: 1.3rem !important;
        }
    }
    
    /* Animações */
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    
    /* Modal responsivo */
    .modal-dialog {
        margin: 10px;
    }
    
    @media (min-width: 576px) {
        .modal-dialog {
            max-width: 500px;
            margin: 1.75rem auto;
        }
    }
    
    /* Botões de ação */
    .btn-group-sm .btn {
        transition: all 0.2s;
    }
    
    .btn-group-sm .btn:hover {
        transform: scale(1.1);
    }
    
    /* Ajustes para telas muito pequenas */
    @media (max-width: 360px) {
        .card-header h5 {
            font-size: 1rem;
        }
        
        .card.border-success-subtle h6,
        .card.border-primary-subtle h6 {
            font-size: 0.9rem;
        }
        
        .btn-mobile-block span {
            font-size: 0.9rem;
        }
        
        .modal-header h5 {
            font-size: 1.1rem;
        }
        
        .modal-body {
            padding: 1rem;
        }
    }
    
    /* Estados interativos */
    .list-group-item {
        transition: background-color 0.2s;
        cursor: pointer;
    }
    
    .list-group-item:hover {
        background-color: rgba(0, 0, 0, 0.02);
    }
    
    /* Cores de badge personalizadas */
    .bg-success-subtle {
        background-color: rgba(40, 167, 69, 0.1) !important;
    }
    
    .bg-primary-subtle {
        background-color: rgba(0, 123, 255, 0.1) !important;
    }
</style>

<!-- JavaScript para funcionalidades -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar tooltips (desktop)
        if (window.innerWidth >= 768) {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }
        
        // Botões de editar
        document.querySelectorAll('.btn-editar').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                
                const grupoId = this.getAttribute('data-grupo-id');
                const grupoTipo = this.getAttribute('data-grupo-tipo');
                
                // Encontrar grupo correspondente
                const grupo = encontrarGrupo(grupoId, grupoTipo);
                
                if (grupo) {
                    // Mostrar modal de edição
                    mostrarModalEdicao(grupo, grupoTipo);
                } else {
                    showToast('Grupo não encontrado', 'warning');
                }
            });
        });
        
        // Botões de excluir
        document.querySelectorAll('.btn-excluir').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                
                const grupoId = this.getAttribute('data-grupo-id');
                const grupoTipo = this.getAttribute('data-grupo-tipo');
                const grupoNome = this.closest('.list-group-item, .card')?.querySelector('h6')?.textContent || 'este grupo';
                
                if (confirm(`Tem certeza que deseja excluir o grupo "${grupoNome}"?\n\nEsta ação não poderá ser desfeita.`)) {
                    // Simular exclusão
                    excluirGrupo(grupoId, grupoTipo, this);
                }
            });
        });
        
        // Função para encontrar grupo
        function encontrarGrupo(id, tipo) {
            // Em produção, isso buscaria do servidor
            // Por enquanto, simular dados
            return {
                id: id,
                nome: `Grupo ${tipo === 'lar' ? 'Lar' : 'Tenda'} ${id}`,
                dia_defumacao: tipo === 'lar' ? 'sabado' : null,
                dia_preferencial: tipo === 'tenda' ? 'sabado' : null,
                ordem_rotacao: tipo === 'lar' ? 1 : null,
                participantes_ids: '1,2,3'
            };
        }
        
        // Função para mostrar modal de edição
        function mostrarModalEdicao(grupo, tipo) {
            // Criar modal dinâmico
            const modalHtml = `
                <div class="modal fade" id="modalEditarGrupo" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header bg-${tipo === 'lar' ? 'success' : 'primary'} text-white">
                                <h5 class="modal-title">
                                    <i class="bi bi-pencil me-2"></i>
                                    Editar Grupo - ${tipo === 'lar' ? 'Lar' : 'Tenda'}
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <form id="formEditarGrupo">
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label class="form-label">Nome do Grupo</label>
                                        <input type="text" class="form-control" name="nome" 
                                               value="${grupo.nome}" required>
                                    </div>
                                    ${tipo === 'lar' ? `
                                    <div class="row g-2">
                                        <div class="col-12 col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Dia da Defumação</label>
                                                <select class="form-select" name="dia_defumacao" required>
                                                    <option value="sabado" ${grupo.dia_defumacao === 'sabado' ? 'selected' : ''}>Sábado</option>
                                                    <option value="domingo" ${grupo.dia_defumacao === 'domingo' ? 'selected' : ''}>Domingo</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Ordem de Rotação</label>
                                                <input type="number" class="form-control" name="ordem_rotacao" 
                                                       value="${grupo.ordem_rotacao || 1}" min="1" max="10">
                                            </div>
                                        </div>
                                    </div>
                                    ` : `
                                    <div class="mb-3">
                                        <label class="form-label">Dia Preferencial</label>
                                        <select class="form-select" name="dia_preferencial">
                                            <option value="">Qualquer dia</option>
                                            <option value="sabado" ${grupo.dia_preferencial === 'sabado' ? 'selected' : ''}>Sábado</option>
                                            <option value="domingo" ${grupo.dia_preferencial === 'domingo' ? 'selected' : ''}>Domingo</option>
                                        </select>
                                    </div>
                                    `}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                        Cancelar
                                    </button>
                                    <button type="submit" class="btn btn-${tipo === 'lar' ? 'success' : 'primary'}">
                                        Salvar Alterações
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            // Adicionar ao body
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('modalEditarGrupo'));
            modal.show();
            
            // Remover modal após fechar
            document.getElementById('modalEditarGrupo').addEventListener('hidden.bs.modal', function () {
                modalContainer.remove();
            });
            
            // Envio do formulário
            document.getElementById('formEditarGrupo')?.addEventListener('submit', function(e) {
                e.preventDefault();
                showToast('Alterações salvas com sucesso!', 'success');
                modal.hide();
            });
        }
        
        // Função para excluir grupo
        function excluirGrupo(id, tipo, button) {
            const item = button.closest('.list-group-item, .card');
            
            if (item) {
                // Animar exclusão
                item.style.opacity = '0.5';
                item.style.transform = 'scale(0.95)';
                item.style.transition = 'all 0.3s';
                
                // Simular exclusão após delay
                setTimeout(() => {
                    item.remove();
                    showToast('Grupo excluído com sucesso', 'danger');
                    
                    // Atualizar contadores
                    atualizarContadores();
                }, 300);
            }
        }
        
        // Função para atualizar contadores
        function atualizarContadores() {
            // Atualizar contagem de grupos Lar
            const gruposLar = document.querySelectorAll('#gruposLar .list-group-item, #gruposLar .card');
            const countLar = gruposLar.length;
            
            // Atualizar contagem de grupos Tenda
            const gruposTenda = document.querySelectorAll('#gruposTenda .list-group-item, #gruposTenda .card');
            const countTenda = gruposTenda.length;
            
            // Atualizar badges (simplificado)
            document.querySelectorAll('.badge').forEach(badge => {
                if (badge.textContent.includes('Grupos Lar') || badge.closest('.card-header')?.querySelector('h5')?.textContent.includes('Lar')) {
                    badge.textContent = countLar;
                } else if (badge.textContent.includes('Grupos Tenda') || badge.closest('.card-header')?.querySelector('h5')?.textContent.includes('Tenda')) {
                    badge.textContent = countTenda;
                }
            });
        }
        
        // Função para mostrar toast
        function showToast(message, type = 'info') {
            // Criar container se não existir
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                toastContainer.style.zIndex = '1100';
                document.body.appendChild(toastContainer);
            }
            
            // Criar toast
            const toastId = 'toast-' + Date.now();
            const toastEl = document.createElement('div');
            toastEl.id = toastId;
            toastEl.className = `toast align-items-center text-bg-${type} border-0`;
            toastEl.setAttribute('role', 'alert');
            toastEl.setAttribute('aria-live', 'assertive');
            toastEl.setAttribute('aria-atomic', 'true');
            
            toastEl.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toastEl);
            
            // Inicializar e mostrar
            const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
            toast.show();
            
            // Remover após ser escondido
            toastEl.addEventListener('hidden.bs.toast', function () {
                toastEl.remove();
            });
        }
        
        // Expandir/collapsar cards em mobile
        if (window.innerWidth < 768) {
            document.querySelectorAll('.card.border-success-subtle, .card.border-primary-subtle').forEach(card => {
                card.addEventListener('click', function(e) {
                    // Não expandir se clicou em botão
                    if (e.target.closest('button')) return;
                    
                    this.classList.toggle('expanded');
                    
                    if (this.classList.contains('expanded')) {
                        this.style.maxHeight = '500px';
                        this.style.transition = 'max-height 0.3s ease';
                    } else {
                        this.style.maxHeight = '150px';
                    }
                });
            });
        }
        
        // Ajustar para diferentes tamanhos de tela
        function adjustForScreenSize() {
            const isMobile = window.innerWidth < 768;
            
            if (isMobile) {
                // Otimizar para mobile
                document.body.classList.add('mobile-view');
                
                // Ajustar tamanho dos cards
                document.querySelectorAll('.card.border-success-subtle, .card.border-primary-subtle').forEach(card => {
                    card.style.maxHeight = '120px';
                    card.style.overflow = 'hidden';
                });
            } else {
                document.body.classList.remove('mobile-view');
                
                // Restaurar cards
                document.querySelectorAll('.card.border-success-subtle, .card.border-primary-subtle').forEach(card => {
                    card.style.maxHeight = '';
                    card.style.overflow = '';
                });
            }
        }
        
        adjustForScreenSize();
        window.addEventListener('resize', adjustForScreenSize);
    });
</script>
{% endblock %}